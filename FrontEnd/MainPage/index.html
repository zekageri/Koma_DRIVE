<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Dr.Random">
    <title>Koma Drive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.2.3/animate.min.css">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="files.css">
</head>
<body>

    <div class="filemanager">
        <div class="search">
            <input type="search" placeholder="Find a file.." />
        </div>
        <div class="breadcrumbs"><span class="folderName">Koma's Drive</span></div>
        <ul class="data animated" id="folderholder">
            <li class="folders">
                <a href="#" title="#" class="folders">
                    <span class="filesicon folder full"></span>
                    <span class="name">Test</span>
                    <span class="details">3 file</span>
                </a>
            </li>
        </ul>
        <div class="nothingfound" style="display: none;">
            <div class="nofiles"></div>
            <span>Nincsenek File-ok vagy mappák.</span>
        </div>
    </div>


    <div id="CreateFolderModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Mappa készítés</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body">

                <form>
                    <div class="form-group">
                      <label for="foldername">Új Mappa Neve</label>
                      <input type="text" class="form-control" id="foldername" aria-describedby="foldernameHelp" placeholder="Név">
                      <small id="foldernameHelp" class="form-text text-muted">Ezzel a névvel fog létrejönni a mappa.</small>
                    </div>
                    <!--
                    <div class="form-group">
                        <label class="settinglabel">Ikon</label>
                        <input type="text" class="icon-class-input" value="fa fa-music" />
                        <button type="button" class="btn btn-primary picker-button">Ikon kiválasztása</button>
                        <span class="demo-icon"></span>
                    </div>
                -->
                </form>
<!-- 
                <div id="iconPicker" style="display: none;">
                    <div class="modal-dialog">
                        <div class="modal-content iconcontent">
                            <div class="modal-header">
                                <button type="button" class="close right" onclick="closeIconPicker()" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title left">Ikon Választó</h4>
                            </div>
                            <div class="modal-body">
                                <div>
                                    <ul class="icon-picker-list">
                                        <li>
                                            <a data-class="{{item}} {{activeState}}" data-index="{{index}}">
                                                <span class="{{item}}"></span>
                                                <span class="name-class">{{item}}</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" id="change-icon" class="btn btn-success">
                                    <span class="fa fa-check-circle-o"></span>
                                    Kiválasztott Ikon használata
                                </button>
                                <button type="button" class="btn btn-default" onclick="closeIconPicker()">Mégsem</button>
                            </div>
                        </div>
                    </div>
                </div>
            -->
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-primary">Készít</button>
              <button type="button" class="btn btn-warning" data-dismiss="modal">Mégsem</button>
            </div>
          </div>
        </div>
      </div>

    <div class="btn-group-fab" role="group" aria-label="FAB Menu">
        <div>
          <button type="button" class="btn btn-main btn-primary has-tooltip" data-placement="left" title="Menu"> <i class="fa fa-file"></i> </button>
          <button type="button" class="btn btn-sub btn-success has-tooltip" data-placement="left" title="Create"> <i class="fa fa-plus"></i> </button>
          <button type="button" class="btn btn-sub btn-danger has-tooltip" data-placement="left" title="Delete"> <i class="fa fa-trash"></i> </button>
          <button type="button" class="btn btn-sub btn-warning has-tooltip" data-placement="left" title="Download"> <i class="fa fa-download"></i> </button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mouse0270-bootstrap-notify/3.1.5/bootstrap-notify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="OwnNotify.js"></script>
    <!-- <script src="index.js"></script> -->
    <script>
        var Drive = {};
        $( document ).ready(function() {
            Notify("Sikeres bejelentkezés!","Üdvözöllek Koma!","success",1500);
            Get_DriveFolders();
            Folder_Things();
        }); 

        function Is_File(name){
            if(name.includes(".")){
                return true;
            }else{
                return false;
            }
        }

        function Is_Folder_Exist(folder){
            if(folder in Drive){
                return true;
            }else{
                return false;
            }
        }
        function Tear_Down_URLs(urls){
            for(var i = 0; i < urls.length; i++){
                var Splitted = urls[i].split("\\");
                var Last = Splitted[Splitted.length - 1];
                var Folder = Splitted[Splitted.length - 2];
                if( Is_File(Last) ){
                    if(Is_Folder_Exist(Folder)){
                        Drive[Folder].push(Last);
                    }else{
                        Drive[Folder] = new Array();
                        Drive[Folder].push(Last);
                    }
                }else{
                    if( !Is_Folder_Exist(Last) ){
                        Drive[Last] = new Array();
                    }
                }
            }
            console.log(Drive);
        }

        /*
        <li class="folders">
                <a href="#" title="#" class="folders">
                    <span class="filesicon folder full"></span>
                    <span class="name">Test2</span>
                    <span class="details">4 file</span>
                </a>
            </li>
        */
        function Generate_Folder(FolderName,FileCount){
            var $LI = $("<li>",{class:"folders"});
            var $A  = $("<a>",{href:"#",title:"#",class:"folders"});
            var $ICON = $("<span>",{class:"filesicon folder full",});
            var $NAME = $("<span>",{class:"name",text:FolderName});
            var $Files = $("<span>",{class:"details",text:FileCount});
            
                $A.append($ICON);
                $A.append($NAME);
                $A.append($Files);
                $LI.append($A);
                $("#folderholder").append($LI);
        }

        function Get_DriveFolders(){
            $.get( "/GetFolders", function( data ) {
                Tear_Down_URLs(data);
                for (const [key, value] of Object.entries(Drive)) {
                    Generate_Folder(key);
                }
            });
        }

        function Folder_Things(){
            $('.btn-group-fab').on('click', '.btn', function() {
                $('.btn-group-fab').toggleClass('active');
                if($(this).prop("title") == "Create"){
                    $('#CreateFolderModal').modal();
                }
            });
            $('has-tooltip').tooltip();
        }


        $(".cf-folder-body").hover(function(){
            $('.cf-folder-file1, .cf-folder-file2, .cf-folder-file3').toggleClass('cf-folder-file-hide');
            $('.cf-folder-file1').toggleClass('cf-folder-file1-show');
            $('.cf-folder-file2').toggleClass('cf-folder-file2-show');
            $('.cf-folder-file3').toggleClass('cf-folder-file3-show');
        });

        

    </script>
</body>
</html>